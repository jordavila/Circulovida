<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Círculo de la Vida</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 10px;
    background: #fdfdfd;
  }
  canvas {
    max-width: 100%;
    height: auto;
  }
  .slider-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 5px 0;
  }
  .slider-container label {
    font-size: 14px;
    margin-bottom: 3px;
  }
  input[type="range"] {
    width: 90%;
  }
  #nameInput {
    width: 90%;
    padding: 5px;
    margin: 10px 0;
    font-size: 16px;
  }
  button {
    padding: 8px 16px;
    font-size: 16px;
    margin-top: 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
  }
</style>
</head>
<body>

<h2>CIRCULO DE LA VIDA<br>Programa Raiz Viva<br>by: Karen Valencia - Health Coach</h2>

<input type="text" id="nameInput" placeholder="Ingresa tu nombre">

<canvas id="myChart"></canvas>

<div id="sliders"></div>

<button id="downloadBtn">Descargar PNG</button>

<script>
const categorias = [
  "Salud física", "Finanzas", "Carrera/Negocio", "Entorno físico",
  "Amigos/Familia", "Diversión", "Desarrollo personal", "Espiritualidad"
];

let valores = new Array(categorias.length).fill(5);

const ctx = document.getElementById('myChart').getContext('2d');

const chart = new Chart(ctx, {
  type: 'radar',
  data: {
    labels: categorias,
    datasets: [{
      label: 'Nivel',
      data: valores,
      fill: true,
      backgroundColor: 'rgba(0,123,255,0.2)',
      borderColor: '#007bff',
      pointBackgroundColor: '#007bff',
      pointBorderColor: '#fff',
      pointHoverBackgroundColor: '#fff',
      pointHoverBorderColor: '#007bff'
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      r: {
        suggestedMin: 0,
        suggestedMax: 10,
        ticks: {
          stepSize: 1,
          backdropColor: 'transparent'
        },
        pointLabels: {
          display: false // Ocultamos para dibujar manualmente
        }
      }
    },
    onClick: (e) => {
      const points = chart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
      if (points.length) {
        const index = points[0].index;
        valores[index] = (valores[index] + 1) % 11;
        chart.update();
        document.getElementById(`slider-${index}`).value = valores[index];
      }
    },
    plugins: {
      legend: { display: false }
    }
  },
  plugins: [{
    id: 'radialLabels',
    afterDraw(chart) {
      const { ctx, chartArea: { width, height }, scales: { r } } = chart;
      ctx.save();
      ctx.font = '12px Arial';
      ctx.fillStyle = '#000';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      categorias.forEach((label, i) => {
        const angle = r.getIndexAngle(i) - Math.PI / 2;
        const radius = r.drawingArea + 20;
        const x = r.xCenter + Math.cos(angle) * radius;
        const y = r.yCenter + Math.sin(angle) * radius;
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(angle + Math.PI / 2);
        ctx.fillText(label, 0, 0);
        ctx.restore();
      });
      ctx.restore();
    }
  }]
});

// Crear sliders
const slidersDiv = document.getElementById('sliders');
categorias.forEach((cat, i) => {
  const container = document.createElement('div');
  container.classList.add('slider-container');
  const label = document.createElement('label');
  label.textContent = cat;
  const slider = document.createElement('input');
  slider.type = 'range';
  slider.min = 0;
  slider.max = 10;
  slider.value = valores[i];
  slider.id = `slider-${i}`;
  slider.addEventListener('input', (e) => {
    valores[i] = Number(e.target.value);
    chart.data.datasets[0].data = valores;
    chart.update();
  });
  container.appendChild(label);
  container.appendChild(slider);
  slidersDiv.appendChild(container);
});

// Descargar PNG
document.getElementById('downloadBtn').addEventListener('click', () => {
  const nombre = document.getElementById('nameInput').value.trim();
  const canvas = document.createElement('canvas');
  const ctx2 = canvas.getContext('2d');
  const originalCanvas = document.getElementById('myChart');

  canvas.width = originalCanvas.width;
  canvas.height = originalCanvas.height + 60;

  ctx2.fillStyle = '#fff';
  ctx2.fillRect(0, 0, canvas.width, canvas.height);

  ctx2.font = '20px Arial';
  ctx2.fillStyle = '#000';
  ctx2.textAlign = 'center';
  ctx2.fillText("CIRCULO DE LA VIDA - Programa Raiz Viva", canvas.width / 2, 25);
  ctx2.fillText("by: Karen Valencia - Health Coach", canvas.width / 2, 50);
  if (nombre) ctx2.fillText(`Participante: ${nombre}`, canvas.width / 2, canvas.height - 20);

  ctx2.drawImage(originalCanvas, 0, 60);

  const link = document.createElement('a');
  link.download = 'circulo_de_la_vida.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});
</script>

</body>
</html>
