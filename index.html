<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Círculo de la Vida</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 10px;
        text-align: center;
    }
    h1 {
        font-size: 1.2em;
        margin-bottom: 5px;
    }
    input, button {
        padding: 8px;
        margin: 5px;
        font-size: 1em;
        width: 90%;
        max-width: 300px;
    }
    canvas {
        max-width: 100%;
        height: auto;
        margin: 0 auto;
        display: block;
    }
    .sliders {
        max-width: 400px;
        margin: 0 auto;
        text-align: left;
    }
    .slider-group {
        margin-bottom: 10px;
    }
    label {
        font-size: 0.9em;
    }
</style>
</head>
<body>

<h1>CIRCULO DE LA VIDA<br>Programa Raiz Viva<br>by: Karen Valencia - Health Coach</h1>
<input type="text" id="nombre" placeholder="Ingresa tu nombre" />

<canvas id="radarChart" width="400" height="400"></canvas>

<div class="sliders" id="sliders"></div>

<button id="descargar">Descargar</button>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas"></script>

<script>
const categorias = [
    "Salud Física",
    "Salud Emocional",
    "Relaciones",
    "Carrera/Trabajo",
    "Finanzas",
    "Crecimiento Personal",
    "Diversión/Ocio",
    "Espiritualidad"
];

let valores = new Array(categorias.length).fill(5);

const ctx = document.getElementById('radarChart').getContext('2d');

const radarChart = new Chart(ctx, {
    type: 'radar',
    data: {
        labels: categorias,
        datasets: [{
            label: 'Tu Círculo',
            data: valores,
            backgroundColor: 'rgba(105, 201, 185, 0.2)',
            borderColor: '#69c9b9',
            borderWidth: 2,
            pointBackgroundColor: '#69c9b9'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            r: {
                suggestedMin: 0,
                suggestedMax: 10,
                ticks: { stepSize: 1, backdropColor: 'transparent' },
                pointLabels: {
                    callback: function(value, index) {
                        return value;
                    },
                    font: { size: 12 },
                    color: '#000'
                }
            }
        },
        plugins: {
            legend: { display: false }
        },
        onClick: (evt) => {
            const points = radarChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
            if (points.length) {
                const idx = points[0].index;
                const coords = radarChart.scales.r.getValueForPixel(radarChart.scales.r.getDistanceFromCenterForValue(0));
                let mousePos = Chart.helpers.getRelativePosition(evt, radarChart);
                let dx = mousePos.x - radarChart.width / 2;
                let dy = mousePos.y - radarChart.height / 2;
                let dist = Math.sqrt(dx*dx + dy*dy);
                let val = Math.round((dist / (radarChart.scales.r.drawingArea)) * 10);
                valores[idx] = Math.min(10, Math.max(1, val));
                radarChart.data.datasets[0].data = valores;
                document.getElementById(`slider-${idx}`).value = valores[idx];
                radarChart.update();
            }
        }
    }
});

// Crear sliders
const slidersDiv = document.getElementById('sliders');
categorias.forEach((cat, i) => {
    const div = document.createElement('div');
    div.className = 'slider-group';
    div.innerHTML = `
        <label>${cat}: <span id="val-${i}">${valores[i]}</span></label>
        <input type="range" min="1" max="10" value="${valores[i]}" id="slider-${i}" />
    `;
    slidersDiv.appendChild(div);
    document.getElementById(`slider-${i}`).addEventListener('input', (e) => {
        valores[i] = parseInt(e.target.value);
        document.getElementById(`val-${i}`).innerText = e.target.value;
        radarChart.data.datasets[0].data = valores;
        radarChart.update();
    });
});

// Botón descargar
document.getElementById('descargar').addEventListener('click', () => {
    const nombre = document.getElementById('nombre').value.trim();
    if (!nombre) { alert('Por favor ingresa tu nombre'); return; }

    // Crear canvas temporal con título y gráfico
    html2canvas(document.body).then(canvas => {
        const ctx2 = canvas.getContext('2d');
        ctx2.font = '16px Arial';
        ctx2.fillStyle = '#000';
        ctx2.fillText(`Participante: ${nombre}`, 10, 30);

        const link = document.createElement('a');
        link.download = `circulo_de_la_vida_${nombre}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });
});
</script>

</body>
</html>
